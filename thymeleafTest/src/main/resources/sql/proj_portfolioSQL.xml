<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="com.example.spring.project.portfolio.PortfolioDAO"> 
<!-- mybatis-confg.xml 에 Alias 되어 있습니다. --> 

	<!-- 디자이너 list-->
	<select id="designerInfo" resultType = "com.example.spring.project.ProjEmpDTO">
		SELECT  
				EMP_NO,				<!-- 사원번호 -->
				EMP_NAME,			<!-- 사원이름 -->
				EMP_GRADE_CD,		<!-- 직급코드 -->
				EMP_GRADE_NM		<!-- 직급명 -->
		FROM PROJ_EMPLOYEE
	</select>
	
	<!-- 파일저장 -->
	<insert id="fileInsert" parameterType = "String"> 
		INSERT INTO PROJ_FILEUPLOAD(
			FILE_NO,		<!-- 파일번호 -->
			FILES,			<!-- 파일경로? -->
			FILE_REGDATE,	<!-- 등록일 -->
			PORTFOLIO_NO	<!-- 포트폴리오 번호 -->
		)  
		VALUES(
			PROJ_FILEUPLOAD_SEQ.NEXTVAL,
			#{file},
			sysdate,
			(SELECT NVL(MAX(PORTFOLIO_NO),0) from PROJ_PORTFOLIO)
		)
	</insert>
	
	<!-- 포트폴리오 저장 -->
	<insert id="portfolioInsert" parameterType = "com.example.spring.project.portfolio.PortfolioDTO"> 
		INSERT INTO PROJ_PORTFOLIO(
			PORTFOLIO_NO,		<!-- 포트폴리오번호 -->
			PORTFOLIO_GOOD_CNT,	<!-- 좋아요수 -->
			EMP_NO,				<!-- 사원번호 -->
			PORTFOLIO_REGDATE,	<!-- 등록일 -->
			PORTFOLIO_ISSHOW	<!-- 삭제여부 -->
		)   
		VALUES(
			PROJ_PORTFOLIO_SEQ.NEXTVAL,
			0,
			#{emp_no},
			SYSDATE,
			'Y'
		)
	</insert>

	 <!-- 포트폴리오 전체LIST -->
	 <select id="portfolioInfo" resultType = "com.example.spring.project.portfolio.PortfolioDTO">
		SELECT  
				P.PORTFOLIO_NO,			<!-- 포트폴리오 번호 -->
				P.PORTFOLIO_GOOD_CNT,	<!-- 포트폴리오 좋아요 수-->
				P.EMP_NO,				<!-- 사원번호 -->
				P.PORTFOLIO_REGDATE,	<!-- 등록일 -->
				P.PORTFOLIO_ISSHOW,		<!-- 포트폴리오 삭제여부 -->
				E.EMP_NAME,				<!-- 사원이름 -->
				E.EMP_GRADE_CD,			<!-- 사원직급코드 -->
				E.EMP_GRADE_NM,			<!-- 사원직급명 -->
				F.FILE_NO,				<!-- 파일번호 -->
				F.FILES					<!-- 파일경로 -->
		FROM PROJ_PORTFOLIO P INNER JOIN PROJ_EMPLOYEE E
		ON P.EMP_NO = E.EMP_NO
		INNER JOIN PROJ_FILEUPLOAD F
		ON P.PORTFOLIO_NO = F.PORTFOLIO_NO
		ORDER BY 
		P.PORTFOLIO_REGDATE DESC
	</select>
	
	<!-- 좋아요 수 증가 -->
	<update id = "portfolioAddGood" parameterType = "int">
		UPDATE PROJ_PORTFOLIO P
		SET P.PORTFOLIO_GOOD_CNT = P.PORTFOLIO_GOOD_CNT+1
		WHERE P.PORTFOLIO_NO = #{portfolio_no}
	</update>
	
	
	<!--<select id="portfolioInfo" resultType = "com.example.spring.project.ProjEmpDTO">
		SELECT  
				E.EMP_NO,				사원번호
				E.EMP_NAME,				사원이름
				E.EMP_GRADE_CD,			사원직급코드
				E.EMP_GRADE_NM			사원직급명
		FROM PROJ_EMPLOYEE E
		ORDER BY 
		E.EMP_GRADE_CD DESC
	</select> -->
	
	<!-- 포트폴리오 상세 -->
<!-- 	<select id="portfolioDetail" resultType = "com.example.spring.project.portfolio.PortfolioDTO" 
								parameterType = "int">
		SELECT  
				P.PORTFOLIO_NO,			포트폴리오 번호
				P.PORTFOLIO_GOOD_CNT,	포트폴리오 좋아요 수
				P.EMP_NO,				사원번호
				P.PORTFOLIO_REGDATE,	등록일
				P.PORTFOLIO_ISSHOW,		포트폴리오 삭제여부
				E.EMP_NAME,				사원이름
				E.EMP_GRADE_CD,			사원직급코드
				E.EMP_GRADE_NM,			사원직급명
				F.FILE_NO,				파일번호
				F.FILES					파일경로
		FROM PROJ_PORTFOLIO P INNER JOIN PROJ_EMPLOYEE E
		ON P.EMP_NO = E.EMP_NO
		INNER JOIN PROJ_FILEUPLOAD F
		ON P.PORTFOLIO_NO = F.PORTFOLIO_NO
		WHERE E.EMP_NO = #{emp_no}
		ORDER BY 
		P.PORTFOLIO_REGDATE DESC
	</select> -->
	
</mapper> 
